#!/usr/bin/perl 

# Usage: 
# ./transform < input-file > output-file
#
# Descrption:
# input-file is standard input (stdin).
# output-file is standard output(stdout).
#
# Date: 10/19/2020
# Author: Iztok Savnik

# consts
$ln = ();
$cn = 0;
%map = ();
$fst = 1;
$count = 0;
$size = 0;
$maxs = 0;

# check lines of in file
while (<STDIN>) {

    chop; chop;

    if (/A\,.*/) { 
       #print $_; 
       
       $cn += 1;

       @a = split "\,";
       #print "A,".$a[1].",".$cn."\n"; 

       $map{$a[1]} = $cn; 
    }

    if (/C\,.*/) { 
       #print $_; 

       #@c = split "\,";
       #print "C,".$c[2]."\n"; 

       if ($fst) { 
          $fst = 0;
       } else {
          if ((scalar @ln) > $maxs) {
             $maxs = (scalar @ln);
          }
          # calc avg size
          $size = $size + (scalar @ln);
          $count++;

          # print set  
          $p = join("\,", (sort { $a <=> $b } @ln));
          print $p." ".(scalar @ln)."\n";
          @ln = ();
       }
    }

    if (/V\,.*/) { 
       #print $_; 

       @l = split "\,";
       #print $l[1]."\n"; 
       push @ln, ($map{$l[1]}); 
    }

    #print $_."\n";
}

print "max=".$maxs."\n";
print "avg=".($size/$count)."\n";
